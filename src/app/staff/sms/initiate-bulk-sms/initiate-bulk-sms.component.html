<div class="content-block bg">
    <div class="row clearfix bg">
        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
            <div class="card">
                <div class="modalHeader">
                    <div class="editRowModal">
                        <div class="modalHeader clearfix">
                            <div class="modalHeader clearfix">
                                <div class="modal-about">
                                    <div class="font-weight-bold p-t-5 font-17">
                                        Send Bulk SMS
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div mat-dialog-content>
                    <form class="register-form m-4" [formGroup]="sendSMSform">
                        <div class="row">
                            <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-1">
                                <mat-form-field class="example-full-width" appearance="outline">
                                    <mat-label>Select Template</mat-label>
                                    <mat-select formControlName="templateName" required
                                        (selectionChange)="displayTemplateBody($event)">
                                        <mat-option *ngFor="let template of templates" [value]="template">
                                            {{ template.templateName }}
                                        </mat-option>
                                    </mat-select>
                                    <mat-error *ngIf="sendSMSform.get('templateName').hasError('required')">
                                        Template is required
                                    </mat-error>
                                </mat-form-field>
                            </div>

                            <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-1">
                                <div class="example-button-row">
                                    <button mat-raised-button color="warn" (click)="onClick()" tabindex="-1">
                                        Cancel
                                    </button>
                                    <button mat-raised-button color="primary" [disabled]="!sendSMSform.valid && recipientsSelected==false"
                                        (click)="submit()">
                                        <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                                        <b>Submit</b>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                                <span>
                                    <div style="color:#046307" [innerHTML]="this.body"></div>
                                </span>
                            </div>
                        </div>

                        <!--All Farmers-->
                        <div class="row" *ngIf="tempSelected">
                            <div class="row">
                                <mat-progress-bar mode="indeterminate" *ngIf="isLoading"></mat-progress-bar>
                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <div class="card">
                                        <div class="body">
                                            <div class="table-responsive">
                                                <div class="materialTableHeader">
                                                    <div class="row">
                                                        <div class="col-10">
                                                            <ul class="header-buttons-left ms-0">
                                                                <li class="dropdown">
                                                                    <h2>Farmers</h2>
                                                                </li>
                                                                <li class="dropdown m-l-20">
                                                                    <label for="search-input"><i
                                                                            class="material-icons search-icon">search</i></label>
                                                                    <input placeholder="Search" type="text"
                                                                        style="text-transform: capitalize;"
                                                                        (keyup)="applyFilter($event)"
                                                                        class="browser-default search-field"
                                                                        aria-label="Search box" />
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <mat-table #table matTableExporter [dataSource]="dataSource" matSort
                                                    class="mat-cell" #exporter="matTableExporter">
                                                    <!-- Checkbox Column -->
                                                    <ng-container matColumnDef="select">
                                                        <mat-header-cell *matHeaderCellDef
                                                            [ngClass]="'tbl-col-width-per-6'">
                                                            <mat-checkbox (change)="$event ? masterToggle() : null"
                                                                [checked]="selection.hasValue() && isAllSelected()"
                                                                [indeterminate]="selection.hasValue() && !isAllSelected()"
                                                                [ngClass]="'tbl-checkbox'">
                                                            </mat-checkbox>
                                                        </mat-header-cell>
                                                        <mat-cell *matCellDef="let row; let i = index"
                                                        [class.odd-row]="i % 2" [class.even-row]="!(i % 2)"
                                                            [ngClass]="'tbl-col-width-per-6'">
                                                            <mat-checkbox (click)="$event.stopPropagation()"
                                                                (change)="$event ? selection.toggle(row) : null"
                                                                [checked]="selection.isSelected(row)"
                                                                [ngClass]="'tbl-checkbox'">
                                                            </mat-checkbox>
                                                        </mat-cell>
                                                    </ng-container>
                                                    <!-- ID Column -->
                                                    <ng-container matColumnDef="id">
                                                        <mat-header-cell class="table-img tbl-col-width-per-8"
                                                            *matHeaderCellDef mat-sort-header>#</mat-header-cell>
                                                        <mat-cell class="table-img tbl-col-width-per-8"
                                                            *matCellDef="let element; let i = index"
                                                            [class.odd-row]="i % 2" [class.even-row]="!(i % 2)">{{i +
                                                            1}}</mat-cell>
                                                    </ng-container>
                                                    <ng-container matColumnDef="farmer_no">
                                                        <mat-header-cell *matHeaderCellDef mat-sort-header
                                                            class="column-nowrap">MemberNumber
                                                        </mat-header-cell>
                                                        <mat-cell *matCellDef="let farmer;let i = index"
                                                            [class.odd-row]="i % 2" [class.even-row]="!(i % 2)"
                                                            class="column-nowrap">
                                                            {{farmer.farmer_no}}
                                                        </mat-cell>
                                                    </ng-container>
                                                    <ng-container matColumnDef="username">
                                                        <mat-header-cell *matHeaderCellDef mat-sort-header
                                                            class="column-nowrap">Name</mat-header-cell>
                                                        <mat-cell *matCellDef="let farmer;let i = index"
                                                            [class.odd-row]="i % 2" [class.even-row]="!(i % 2)"
                                                            class="column-nowrap">
                                                            {{farmer.username}}
                                                        </mat-cell>
                                                    </ng-container>
                                                    <ng-container matColumnDef="mobile_no">
                                                        <mat-header-cell *matHeaderCellDef mat-sort-header
                                                            class="column-nowrap">PhoneNumber</mat-header-cell>
                                                        <mat-cell *matCellDef="let farmer;let i = index"
                                                            [class.odd-row]="i % 2" [class.even-row]="!(i % 2)"
                                                            class="column-nowrap">
                                                            {{farmer.mobile_no}}
                                                        </mat-cell>
                                                    </ng-container>
                                                    <ng-container matColumnDef="ID No.">
                                                        <mat-header-cell *matHeaderCellDef mat-sort-header
                                                            class="column-nowrap">IDNumber</mat-header-cell>
                                                        <mat-cell *matCellDef="let farmer;let i = index"
                                                            [class.odd-row]="i % 2" [class.even-row]="!(i % 2)"
                                                            class="column-nowrap">
                                                            {{farmer.id_number}}
                                                        </mat-cell>
                                                    </ng-container>
                                                    <mat-header-row
                                                        *matHeaderRowDef="displayedColumns"></mat-header-row>
                                                    <mat-row *matRowDef="let row; columns: displayedColumns" [style.cursor]="'pointer'"
                                                        matRipple>
                                                    </mat-row>
                                                    <mat-cell *matNoDataRow colspan="4">
                                                        No data matching the filter "{{ input.value }}"</mat-cell>
                                                </mat-table>

                                                <!-- Loading spinner -->
                                                <div *ngIf="isLoading" class="tbl-spinner">
                                                    <mat-progress-spinner color="primary" [diameter]="50"
                                                        mode="indeterminate">
                                                    </mat-progress-spinner>
                                                </div>

                                                <div class="tbl-spinner" *ngIf="isdata==false && !isLoading">
                                                    <h4>0 Records Found</h4>
                                                </div>

                                                <mat-paginator #paginator [pageIndex]="0" [pageSize]="3"
                                                    [pageSizeOptions]="[5, 10, 25, 100]">
                                                </mat-paginator>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>